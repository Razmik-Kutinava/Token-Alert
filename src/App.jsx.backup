import { createSignal, createEffect, For, onCleanup } from 'solid-js';
import { 
  Bell, 
  Star, 
  User, 
  TrendingUp, 
  Edit3, 
  Trash2, 
  Plus,
  Check,
  X,
  AlertTriangle,
  Wifi,
  WifiOff,
  LogIn,
  LogOut
} from  /**
   * –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ü–µ–Ω –∫–∞–∂–¥—ã–µ 2 –º–∏–Ω—É—Ç—ã (—Ä–µ–∞–ª—å–Ω—ã–π API –∏–º–µ–µ—Ç –ª–∏–º–∏—Ç—ã)
   */
  createEffect(() => {
    if (!user()) return;
    
    const interval = setInterval(async () => {
      try {
        const updatedAlerts = await supabaseAPI.updateAlertPrices();
        setAlerts([...updatedAlerts]);-solid';
import { realAPI } from './realAPI';
import { supabaseAPI } from './supabaseAPI';
import { supabase, testConnection } from './supabaseClient';

/**
 * –ì–ª–∞–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ Token Alert Manager
 */
function App() {
  // –°–∏–≥–Ω–∞–ª—ã –¥–ª—è —Å–æ—Å—Ç–æ—è–Ω–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
  const [alerts, setAlerts] = createSignal([]);
  const [isLoading, setIsLoading] = createSignal(true);
  const [toast, setToast] = createSignal(null);
  const [isOnline, setIsOnline] = createSignal(true);
  
  // –°–∏–≥–Ω–∞–ª—ã –¥–ª—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
  const [user, setUser] = createSignal(null);
  const [isAuthLoading, setIsAuthLoading] = createSignal(true);
  const [email, setEmail] = createSignal('');
  const [password, setPassword] = createSignal('');
  
  // –°–∏–≥–Ω–∞–ª—ã –¥–ª—è –∂–∏–≤–æ–≥–æ —Ç–∞–±–ª–æ —Ü–µ–Ω
  const [livePrices, setLivePrices] = createSignal({});
  const [pricesLoading, setPricesLoading] = createSignal(true);
  const [lastUpdated, setLastUpdated] = createSignal(null);
  
  // –°–∏–≥–Ω–∞–ª—ã –¥–ª—è —Ñ–æ—Ä–º—ã
  const [selectedToken, setSelectedToken] = createSignal('bitcoin');
  const [condition, setCondition] = createSignal('less');
  const [targetPrice, setTargetPrice] = createSignal('');
  const [notificationType, setNotificationType] = createSignal('web');
  const [isSubmitting, setIsSubmitting] = createSignal(false);
  
  // –ü–æ–ª—É—á–∞–µ–º —Ç–æ–∫–µ–Ω—ã –∏–∑ API
  const tokens = realAPI.getSupportedTokens();
  
  // –¢–∞—Ä–∏—Ñ–Ω—ã–µ –ø–ª–∞–Ω—ã
  const plans = [
    {
      name: 'Free',
      price: '0$',
      period: '–Ω–∞–≤—Å–µ–≥–¥–∞',
      features: ['3 —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è', '–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ 1 —Ä–∞–∑/—á–∞—Å', '–¢–æ–ª—å–∫–æ Web Push'],
      maxAlerts: 3,
      isPopular: false
    },
    {
      name: 'Pro',
      price: '3$',
      period: '–º–µ—Å—è—Ü',
      features: ['20 —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π', '–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç', 'Web + Telegram'],
      maxAlerts: 20,
      isPopular: true
    },
    {
      name: 'Premium',
      price: '8$',
      period: '–º–µ—Å—è—Ü',
      features: ['–ë–µ–∑–ª–∏–º–∏—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π', '–í—Å–µ —Ç–∏–ø—ã –æ–ø–æ–≤–µ—â–µ–Ω–∏–π', '–í–∫–ª—é—á–∞—è SMS'],
      maxAlerts: Infinity,
      isPopular: false
    }
  ];
  
  const currentPlan = plans[1]; // Pro Plan
  
  /**
   * –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
   */
  createEffect(async () => {
    try {
      setIsAuthLoading(true);
      const { data: { user } } = await supabase.auth.getUser();
      setUser(user);
      
      // –¢–µ—Å—Ç–∏—Ä—É–µ–º –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Supabase
      await testConnection();
    } catch (error) {
      console.error('Auth check failed:', error);
    } finally {
      setIsAuthLoading(false);
    }
  });

  /**
   * –°–ª—É—à–∞–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
   */
  createEffect(() => {
    const { data: { subscription } } = supabase.auth.onAuthStateChange(
      (event, session) => {
        setUser(session?.user ?? null);
        if (session?.user) {
          loadAlerts();
        } else {
          setAlerts([]);
        }
      }
    );

    onCleanup(() => subscription.unsubscribe());
  });

  /**
   * –í—Ö–æ–¥ –≤ —Å–∏—Å—Ç–µ–º—É
   */
  const signIn = async () => {
    try {
      setIsSubmitting(true);
      const { error } = await supabase.auth.signInWithPassword({
        email: email(),
        password: password()
      });
      
      if (error) throw error;
      
      showToast('–£—Å–ø–µ—à–Ω—ã–π –≤—Ö–æ–¥ –≤ —Å–∏—Å—Ç–µ–º—É!', 'success');
      setEmail('');
      setPassword('');
    } catch (error) {
      showToast(error.message, 'error');
    } finally {
      setIsSubmitting(false);
    }
  };

  /**
   * –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
   */
  const signUp = async () => {
    try {
      setIsSubmitting(true);
      const { error } = await supabase.auth.signUp({
        email: email(),
        password: password()
      });
      
      if (error) throw error;
      
      showToast('–ü—Ä–æ–≤–µ—Ä—å—Ç–µ email –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏!', 'success');
      setEmail('');
      setPassword('');
    } catch (error) {
      showToast(error.message, 'error');
    } finally {
      setIsSubmitting(false);
    }
  };

  /**
   * –í—ã—Ö–æ–¥ –∏–∑ —Å–∏—Å—Ç–µ–º—ã
   */
  const signOut = async () => {
    try {
      const { error } = await supabase.auth.signOut();
      if (error) throw error;
      showToast('–í—ã—Ö–æ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω —É—Å–ø–µ—à–Ω–æ!', 'success');
    } catch (error) {
      showToast(error.message, 'error');
    }
  };

  /**
   * –ó–∞–≥—Ä—É–∑–∫–∞ –æ–ø–æ–≤–µ—â–µ–Ω–∏–π
   */
  const loadAlerts = async () => {
    if (!user()) return;
    
    try {
      setIsLoading(true);
      const fetchedAlerts = await supabaseAPI.fetchAlerts();
      setAlerts(fetchedAlerts);
      setIsOnline(true);
    } catch (error) {
      console.error('Error fetching alerts:', error);
      setIsOnline(false);
      showToast('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É.', 'error');
    } finally {
      setIsLoading(false);
    }
  };
  
  /**
   * –ó–∞–≥—Ä—É–∑–∫–∞ –æ–ø–æ–≤–µ—â–µ–Ω–∏–π –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
   */
  createEffect(async () => {
    if (user()) {
      await loadAlerts();
    }
  });
  
  /**
   * –ó–∞–≥—Ä—É–∑–∫–∞ –∞–∫—Ç—É–∞–ª—å–Ω—ã—Ö —Ü–µ–Ω –≤—Å–µ—Ö —Ç–æ–∫–µ–Ω–æ–≤
   */
  const loadLivePrices = async () => {
    try {
      setPricesLoading(true);
      const prices = await realAPI.fetchAllTokenPrices();
      setLivePrices(prices);
      setLastUpdated(new Date());
      setIsOnline(true);
    } catch (error) {
      console.error('Error fetching live prices:', error);
      setIsOnline(false);
    } finally {
      setPricesLoading(false);
    }
  };
  
  /**
   * –ó–∞–≥—Ä—É–∑–∫–∞ —Ü–µ–Ω –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
   */
  createEffect(() => {
    loadLivePrices();
  });
  
  /**
   * –ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ü–µ–Ω –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥
   */
  createEffect(() => {
    const interval = setInterval(() => {
      loadLivePrices();
    }, 30000); // 30 —Å–µ–∫—É–Ω–¥ –¥–ª—è –∂–∏–≤–æ–≥–æ —Ç–∞–±–ª–æ
    
    onCleanup(() => clearInterval(interval));
  });
  
  /**
   * –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ü–µ–Ω –∫–∞–∂–¥—ã–µ 2 –º–∏–Ω—É—Ç—ã (—Ä–µ–∞–ª—å–Ω—ã–π API –∏–º–µ–µ—Ç –ª–∏–º–∏—Ç—ã)
   */
  createEffect(() => {
    const interval = setInterval(async () => {
      try {
        const updatedAlerts = await realAPI.updateAlertPrices();
        setAlerts([...updatedAlerts]);
        setIsOnline(true);
      } catch (error) {
        console.error('Error updating prices:', error);
        setIsOnline(false);
      }
    }, 120000); // 2 –º–∏–Ω—É—Ç—ã –≤–º–µ—Å—Ç–æ 30 —Å–µ–∫—É–Ω–¥ –¥–ª—è —ç–∫–æ–Ω–æ–º–∏–∏ API –∑–∞–ø—Ä–æ—Å–æ–≤
    
    onCleanup(() => clearInterval(interval));
  });
  
  /**
   * –ü–æ–∫–∞–∑–∞—Ç—å Toast —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
   */
  const showToast = (message, type = 'success') => {
    setToast({ message, type });
    setTimeout(() => setToast(null), 3000);
  };
  
  /**
   * –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤–æ–µ –æ–ø–æ–≤–µ—â–µ–Ω–∏–µ
   */
  const handleAddAlert = async (e) => {
    e.preventDefault();
    
    if (!targetPrice() || isNaN(targetPrice())) {
      showToast('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—É—é —Ü–µ–Ω—É', 'error');
      return;
    }
    
    const currentAlerts = alerts();
    if (currentAlerts.length >= currentPlan.maxAlerts) {
      showToast(`–ü—Ä–µ–≤—ã—à–µ–Ω –ª–∏–º–∏—Ç —Ç–∞—Ä–∏—Ñ–∞ ${currentPlan.name} (${currentPlan.maxAlerts} –æ–ø–æ–≤–µ—â–µ–Ω–∏–π)`, 'error');
      return;
    }
    
    const selectedTokenData = tokens.find(t => t.id === selectedToken());
    setIsSubmitting(true);
    
    try {
      const alertData = {
        tokenId: selectedToken(),
        tokenName: selectedTokenData.name,
        tokenSymbol: selectedTokenData.symbol,
        condition: condition(),
        targetPrice: parseFloat(targetPrice()),
        notificationType: notificationType()
      };
      
      const response = await realAPI.createAlert(alertData);
      
      if (response.success) {
        setAlerts([...currentAlerts, response.alert]);
        setTargetPrice('');
        showToast('–û–ø–æ–≤–µ—â–µ–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω–æ!');
        setIsOnline(true);
      }
    } catch (error) {
      console.error('Error creating alert:', error);
      showToast('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –æ–ø–æ–≤–µ—â–µ–Ω–∏—è. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É.', 'error');
      setIsOnline(false);
    } finally {
      setIsSubmitting(false);
    }
  };
  
  /**
   * –£–¥–∞–ª–∏—Ç—å –æ–ø–æ–≤–µ—â–µ–Ω–∏–µ
   */
  const handleDeleteAlert = async (alertId) => {
    try {
      const response = await realAPI.deleteAlert(alertId);
      
      if (response.success) {
        setAlerts(alerts().filter(alert => alert.id !== alertId));
        showToast('–û–ø–æ–≤–µ—â–µ–Ω–∏–µ —É–¥–∞–ª–µ–Ω–æ');
        setIsOnline(true);
      }
    } catch (error) {
      console.error('Error deleting alert:', error);
      showToast('–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –æ–ø–æ–≤–µ—â–µ–Ω–∏—è', 'error');
      setIsOnline(false);
    }
  };
  
  /**
   * –ü–æ–ª—É—á–∏—Ç—å —Ü–≤–µ—Ç –±–µ–π–¥–∂–∞ —Ç–æ–∫–µ–Ω–∞
   */
  const getTokenBadgeColor = (tokenId) => {
    const colors = {
      bitcoin: 'bg-gradient-to-r from-yellow-400 to-orange-500',
      ethereum: 'bg-gradient-to-r from-blue-400 to-purple-500',
      solana: 'bg-gradient-to-r from-purple-400 to-pink-500',
      cardano: 'bg-gradient-to-r from-blue-500 to-indigo-600',
      polkadot: 'bg-gradient-to-r from-pink-500 to-red-500',
      avalanche: 'bg-gradient-to-r from-red-400 to-pink-500',
      chainlink: 'bg-gradient-to-r from-blue-600 to-indigo-700',
      polygon: 'bg-gradient-to-r from-purple-600 to-blue-600'
    };
    return colors[tokenId] || 'bg-gradient-to-r from-gray-400 to-gray-600';
  };
  
  /**
   * –ü–æ–ª—É—á–∏—Ç—å —Ü–≤–µ—Ç –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ü–µ–Ω—ã (–∑–µ–ª–µ–Ω—ã–π/–∫—Ä–∞—Å–Ω—ã–π)
   */
  const getPriceChangeColor = (change) => {
    if (change > 0) return 'text-green-400';
    if (change < 0) return 'text-red-400';
    return 'text-gray-400';
  };
  
  /**
   * –ü–æ–ª—É—á–∏—Ç—å –∏–∫–æ–Ω–∫—É –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ü–µ–Ω—ã (—Å—Ç—Ä–µ–ª–∫–∞ –≤–≤–µ—Ä—Ö/–≤–Ω–∏–∑)
   */
  const getPriceChangeIcon = (change) => {
    if (change > 0) return '‚Üó';
    if (change < 0) return '‚Üò';
    return '‚Üí';
  };
  
  /**
   * –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞—Ç—å —Ü–µ–Ω—É –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
   */
  const formatPrice = (price) => {
    if (typeof price !== 'number' || isNaN(price)) return 'N/A';
    
    if (price >= 1000) {
      return price.toLocaleString('en-US', {
        minimumFractionDigits: 2,
        maximumFractionDigits: 2
      });
    } else if (price >= 1) {
      return price.toLocaleString('en-US', {
        minimumFractionDigits: 2,
        maximumFractionDigits: 4
      });
    } else {
      return price.toLocaleString('en-US', {
        minimumFractionDigits: 4,
        maximumFractionDigits: 8
      });
    }
  };
  const getConditionText = (condition, targetPrice) => {
    const formattedPrice = formatPrice(targetPrice);
    const conditionMap = {
      less: `< $${formattedPrice}`,
      greater: `> $${formattedPrice}`,
      equal: `= $${formattedPrice}`
    };
    return conditionMap[condition] || '';
  };
  
  return (
    <div class="min-h-screen bg-dark-bg text-white">
      {/* Header */}
      <header class="bg-dark-card border-b border-gray-700">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4">
          <div class="flex items-center justify-between">
            {/* Logo */}
            <div class="flex items-center space-x-3">
              <div class="w-10 h-10 bg-gradient-to-r from-accent-red to-accent-teal rounded-lg flex items-center justify-center">
                <Bell class="w-6 h-6 text-white" />
              </div>
              <h1 class="text-2xl font-bold gradient-text">Token Alert</h1>
            </div>
            
            {/* User Info */}
            <div class="flex items-center space-x-4">
              {/* Connection Status */}
              <div class={`flex items-center space-x-2 px-3 py-1 rounded-full text-sm font-medium transition-all duration-300 ${
                isOnline() 
                  ? 'bg-green-600/20 text-green-400 border border-green-600/30' 
                  : 'bg-red-600/20 text-red-400 border border-red-600/30'
              }`}>
                {isOnline() ? (
                  <>
                    <Wifi class="w-4 h-4" />
                    <span>Online</span>
                  </>
                ) : (
                  <>
                    <WifiOff class="w-4 h-4" />
                    <span>Offline</span>
                  </>
                )}
              </div>
              
              <div class="bg-gradient-to-r from-purple-600 to-blue-600 px-3 py-1 rounded-full text-sm font-medium">
                Pro Plan
              </div>
              <div class="w-10 h-10 bg-gradient-to-r from-accent-teal to-blue-500 rounded-full flex items-center justify-center">
                <span class="text-sm font-bold">JD</span>
              </div>
            </div>
          </div>
        </div>
      </header>
      
      <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        {/* Hero Section */}
        <div class="text-center mb-12">
          <h2 class="text-4xl sm:text-5xl font-bold mb-4">
            –£–º–Ω—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ —Ü–µ–Ω–∞—Ö{' '}
            <span class="gradient-text">–∫—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç</span>
          </h2>
          <p class="text-xl text-gray-400 max-w-3xl mx-auto mb-8">
            –ü–æ–ª—É—á–∞–π—Ç–µ –º–≥–Ω–æ–≤–µ–Ω–Ω—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –∫–æ–≥–¥–∞ —Ü–µ–Ω—ã –≤–∞—à–∏—Ö –ª—é–±–∏–º—ã—Ö –∫—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç 
            –¥–æ—Å—Ç–∏–≥–∞—é—Ç –∑–∞–¥–∞–Ω–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ —É–º–Ω—ã–µ –∞–ª–µ—Ä—Ç—ã –∏ –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ —É–ø—É—Å–∫–∞–π—Ç–µ 
            –≤—ã–≥–æ–¥–Ω—ã–µ –º–æ–º–µ–Ω—Ç—ã –¥–ª—è —Ç–æ—Ä–≥–æ–≤–ª–∏.
          </p>
        </div>
        
        {/* Live Crypto Dashboard */}
        <div class="mb-12">
          <div class="text-center mb-6">
            <h3 class="text-2xl font-bold mb-2">
              üí∞ –ñ–∏–≤–æ–µ —Ç–∞–±–ª–æ —Ü–µ–Ω
            </h3>
            <p class="text-gray-400 mb-2">
              –ê–∫—Ç—É–∞–ª—å–Ω—ã–µ —Ü–µ–Ω—ã –∫—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥
            </p>
            {lastUpdated() && (
              <p class="text-sm text-gray-500">
                –ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ: {lastUpdated().toLocaleTimeString('ru-RU')}
              </p>
            )}
          </div>
          
          <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
            <For each={tokens}>
              {(token) => {
                const price = () => livePrices()[token.id];
                const change24h = () => price()?.change24h || 0;
                
                return (
                  <div class="bg-dark-card rounded-xl p-4 border border-gray-700 hover:border-gray-600 transition-all duration-300">
                    <div class="flex items-center justify-between mb-2">
                      <div class="flex items-center space-x-2">
                        <div class={`w-8 h-8 rounded-full ${getTokenBadgeColor(token.id)} flex items-center justify-center text-white text-xs font-bold`}>
                          {token.symbol.slice(0, 2)}
                        </div>
                        <div>
                          <div class="text-sm font-medium">{token.symbol}</div>
                          <div class="text-xs text-gray-400">{token.name}</div>
                        </div>
                      </div>
                    </div>
                    
                    <div class="space-y-1">
                      {pricesLoading() ? (
                        <div class="text-lg font-bold text-gray-400">
                          –ó–∞–≥—Ä—É–∑–∫–∞...
                        </div>
                      ) : price() ? (
                        <>
                          <div class="text-lg font-bold">
                            ${formatPrice(price().price)}
                          </div>
                          <div class={`text-sm font-medium flex items-center ${getPriceChangeColor(change24h())}`}>
                            <span class="mr-1">{getPriceChangeIcon(change24h())}</span>
                            {change24h() > 0 ? '+' : ''}{change24h().toFixed(2)}%
                          </div>
                        </>
                      ) : (
                        <div class="text-lg font-bold text-red-400">
                          –û—à–∏–±–∫–∞
                        </div>
                      )}
                    </div>
                  </div>
                );
              }}
            </For>
          </div>
        </div>
        
        {/* Pricing Cards */}
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-12">
          <For each={plans}>
            {(plan) => (
              <div class={`relative bg-dark-card rounded-2xl p-6 border transition-all duration-300 hover:scale-105 hover:shadow-2xl ${
                plan.isPopular 
                  ? 'border-accent-teal shadow-lg shadow-accent-teal/20' 
                  : 'border-gray-700 hover:border-gray-600'
              }`}>
                {plan.isPopular && (
                  <div class="absolute -top-3 left-1/2 transform -translate-x-1/2">
                    <div class="bg-gradient-to-r from-accent-red to-accent-teal px-4 py-1 rounded-full text-sm font-bold text-white">
                      –ü–æ–ø—É–ª—è—Ä–Ω—ã–π
                    </div>
                  </div>
                )}
                
                <div class="text-center mb-6">
                  <h3 class="text-2xl font-bold mb-2">{plan.name}</h3>
                  <div class="text-3xl font-bold gradient-text mb-1">
                    {plan.price}
                  </div>
                  <div class="text-gray-400">/{plan.period}</div>
                </div>
                
                <ul class="space-y-3 mb-6">
                  <For each={plan.features}>
                    {(feature) => (
                      <li class="flex items-center space-x-3">
                        <Check class="w-5 h-5 text-accent-teal flex-shrink-0" />
                        <span class="text-gray-300">{feature}</span>
                      </li>
                    )}
                  </For>
                </ul>
                
                <button class={`w-full py-3 px-4 rounded-xl font-semibold transition-all duration-300 ${
                  plan.isPopular
                    ? 'bg-gradient-to-r from-accent-red to-accent-teal hover:shadow-lg'
                    : 'bg-gray-700 hover:bg-gray-600'
                }`}>
                  {plan.name === currentPlan.name ? '–¢–µ–∫—É—â–∏–π –ø–ª–∞–Ω' : '–í—ã–±—Ä–∞—Ç—å –ø–ª–∞–Ω'}
                </button>
              </div>
            )}
          </For>
        </div>
        
        {/* Alert Form */}
        <div class="bg-dark-card rounded-2xl p-6 mb-8">
          <h3 class="text-2xl font-bold mb-6 flex items-center">
            <Plus class="w-6 h-6 mr-2 text-accent-teal" />
            –°–æ–∑–¥–∞—Ç—å –æ–ø–æ–≤–µ—â–µ–Ω–∏–µ
          </h3>
          
          <form onSubmit={handleAddAlert} class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4">
            {/* Token Select */}
            <div>
              <label class="block text-sm font-medium text-gray-300 mb-2">–¢–æ–∫–µ–Ω</label>
              <select 
                value={selectedToken()}
                onInput={(e) => setSelectedToken(e.target.value)}
                class="w-full bg-gray-700 border border-gray-600 rounded-lg px-3 py-2 text-white focus:outline-none focus:border-accent-teal"
              >
                <For each={tokens}>
                  {(token) => (
                    <option value={token.id}>{token.name} ({token.symbol})</option>
                  )}
                </For>
              </select>
            </div>
            
            {/* Condition Select */}
            <div>
              <label class="block text-sm font-medium text-gray-300 mb-2">–£—Å–ª–æ–≤–∏–µ</label>
              <select 
                value={condition()}
                onInput={(e) => setCondition(e.target.value)}
                class="w-full bg-gray-700 border border-gray-600 rounded-lg px-3 py-2 text-white focus:outline-none focus:border-accent-teal"
              >
                <option value="less">–ú–µ–Ω—å—à–µ —á–µ–º</option>
                <option value="greater">–ë–æ–ª—å—à–µ —á–µ–º</option>
                <option value="equal">–†–∞–≤–Ω–æ</option>
              </select>
            </div>
            
            {/* Target Price Input */}
            <div>
              <label class="block text-sm font-medium text-gray-300 mb-2">–¶–µ–ª–µ–≤–∞—è —Ü–µ–Ω–∞</label>
              <input 
                type="number"
                step="0.01"
                placeholder="0.00"
                value={targetPrice()}
                onInput={(e) => setTargetPrice(e.target.value)}
                class="w-full bg-gray-700 border border-gray-600 rounded-lg px-3 py-2 text-white focus:outline-none focus:border-accent-teal"
              />
            </div>
            
            {/* Notification Type */}
            <div>
              <label class="block text-sm font-medium text-gray-300 mb-2">–¢–∏–ø —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è</label>
              <select 
                value={notificationType()}
                onInput={(e) => setNotificationType(e.target.value)}
                class="w-full bg-gray-700 border border-gray-600 rounded-lg px-3 py-2 text-white focus:outline-none focus:border-accent-teal"
              >
                <option value="web">Web Push</option>
                <option value="telegram">Telegram</option>
                <option value="web_telegram">Web + Telegram</option>
              </select>
            </div>
            
            {/* Submit Button */}
            <div class="flex items-end">
              <button 
                type="submit"
                disabled={isSubmitting()}
                class={`w-full py-2 px-4 rounded-lg font-semibold transition-all duration-300 flex items-center justify-center space-x-2 ${
                  isSubmitting() 
                    ? 'bg-gray-600 cursor-not-allowed' 
                    : 'bg-gradient-to-r from-accent-red to-accent-teal hover:shadow-lg'
                }`}
              >
                {isSubmitting() ? (
                  <>
                    <div class="animate-spin w-4 h-4 border-2 border-white border-t-transparent rounded-full"></div>
                    <span>–î–æ–±–∞–≤–ª–µ–Ω–∏–µ...</span>
                  </>
                ) : (
                  <>
                    <Plus class="w-4 h-4" />
                    <span>–î–æ–±–∞–≤–∏—Ç—å</span>
                  </>
                )}
              </button>
            </div>
          </form>
        </div>
        
        {/* Active Alerts */}
        <div class="bg-dark-card rounded-2xl p-6">
          <div class="flex items-center justify-between mb-6">
            <h3 class="text-2xl font-bold flex items-center">
              <TrendingUp class="w-6 h-6 mr-2 text-accent-teal" />
              –ê–∫—Ç–∏–≤–Ω—ã–µ –æ–ø–æ–≤–µ—â–µ–Ω–∏—è
            </h3>
            <div class="text-lg font-semibold text-accent-teal">
              {alerts().length}/{currentPlan.maxAlerts === Infinity ? '‚àû' : currentPlan.maxAlerts} –∞–∫—Ç–∏–≤–Ω—ã—Ö
            </div>
          </div>
          
          {isLoading() ? (
            <div class="text-center py-8">
              <div class="animate-spin w-8 h-8 border-2 border-accent-teal border-t-transparent rounded-full mx-auto"></div>
              <div class="mt-2 text-gray-400">–ó–∞–≥—Ä—É–∑–∫–∞ –æ–ø–æ–≤–µ—â–µ–Ω–∏–π...</div>
            </div>
          ) : alerts().length === 0 ? (
            <div class="text-center py-8 text-gray-400">
              <AlertTriangle class="w-12 h-12 mx-auto mb-4 opacity-50" />
              <div class="text-lg">–ù–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö –æ–ø–æ–≤–µ—â–µ–Ω–∏–π</div>
              <div class="text-sm">–°–æ–∑–¥–∞–π—Ç–µ –ø–µ—Ä–≤–æ–µ –æ–ø–æ–≤–µ—â–µ–Ω–∏–µ –≤—ã—à–µ</div>
            </div>
          ) : (
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
              <For each={alerts()}>
                {(alert) => (
                  <div class="bg-gray-800 rounded-xl p-4 transition-all duration-300 hover:bg-gray-750 border border-gray-700">
                    <div class="flex items-center justify-between mb-3">
                      <div class="flex items-center space-x-3">
                        <div class={`token-badge ${getTokenBadgeColor(alert.tokenId)}`}>
                          {alert.tokenSymbol}
                        </div>
                        <div>
                          <div class="font-semibold">{alert.tokenName}</div>
                          <div class="text-sm text-gray-400">
                            –ï—Å–ª–∏ —Ü–µ–Ω–∞ {getConditionText(alert.condition, alert.targetPrice)}
                          </div>
                        </div>
                      </div>
                    </div>
                    
                    <div class="mb-3">
                      <div class="text-sm text-gray-400 mb-1">–¢–µ–∫—É—â–∞—è —Ü–µ–Ω–∞:</div>
                      <div class="text-xl font-bold text-white">
                        ${formatPrice(alert.currentPrice)}
                      </div>
                    </div>
                    
                    <div class="flex items-center justify-between">
                      <div class="text-sm text-gray-400">
                        {alert.notificationType === 'web' && 'Web Push'}
                        {alert.notificationType === 'telegram' && 'Telegram'}
                        {alert.notificationType === 'web_telegram' && 'Web + Telegram'}
                      </div>
                      
                      <div class="flex space-x-2">
                        <button class="p-2 text-gray-400 hover:text-accent-teal transition-colors">
                          <Edit3 class="w-4 h-4" />
                        </button>
                        <button 
                          onClick={() => handleDeleteAlert(alert.id)}
                          class="p-2 text-gray-400 hover:text-accent-red transition-colors"
                        >
                          <Trash2 class="w-4 h-4" />
                        </button>
                      </div>
                    </div>
                  </div>
                )}
              </For>
            </div>
          )}
        </div>
      </main>
      
      {/* Toast Notifications */}
      {toast() && (
        <div class="fixed top-4 right-4 z-50 animate-slide-up">
          <div class={`rounded-lg p-4 shadow-lg max-w-sm ${
            toast().type === 'error' 
              ? 'bg-red-600 text-white'
              : toast().type === 'success'
              ? 'bg-green-600 text-white'
              : 'bg-blue-600 text-white'
          }`}>
            <div class="flex items-center justify-between">
              <div class="flex items-center space-x-2">
                {toast().type === 'error' ? (
                  <X class="w-5 h-5" />
                ) : toast().type === 'success' ? (
                  <Check class="w-5 h-5" />
                ) : (
                  <AlertTriangle class="w-5 h-5" />
                )}
                <span class="font-medium">{toast().message}</span>
              </div>
              <button 
                onClick={() => setToast(null)}
                class="ml-4 text-white/80 hover:text-white"
              >
                <X class="w-4 h-4" />
              </button>
            </div>
          </div>
        </div>
      )}
    </div>
  );
}

export default App;